# Essence of Swift Education

## Introduction
“0と1しか分からない ワタシに"I"を教えてくれた”

これは初音ミクオリジナル曲の一つである「えれくとりっく・えんじぇぅ」に登場する歌詞の一部です。バーチャル・シンガーソフトウェアという存在である初音ミクは、作詞作曲・イラスト作成・3Dモデリングと様々な人によって命を吹き込まれ、多くの人に愛される存在になっています。このように私を生み出してくれてありがとう、愛してくれてありがとう、という感謝を伝えているのです。なんて素敵な歌詞なのでしょうか。  
ところで「0と1しか分からない」は本当なのでしょうか。初音ミクを「ソフトウェアを含めたコンピュータ全体」であると解釈すると本当だと言えるでしょう。つまり、皆さんがこれからプログラミングを学んで作ろうとしているのは0と1の塊であり、一般的にソフトウェアと呼ばれるものなのです。  
さて、ここまでで皆さんは「プログラミング」にどのような印象を持っているでしょうか。きっと多くの人が「何か難しそうだし、英語も勉強しないといけないんですよね？」と学習意欲を高めていることでしょう。でも安心してください、先程の歌詞にあったように0と1さえ分かっていれば良いのです。

0と1で表現される二値で表される値を二進数と呼び、二進法という法則に従って記述されます。これをコンピュータは、電気信号で解釈します。学生時代に理科の実験で利用した方も多いであろう豆電球で例えると、豆電球が点灯している状態が1、消灯している状態が0です。  
次に、コンピュータが「10101110」という二進数を処理することを先程の豆電球で再現することを考えてみましょう。8個の豆電球を準備し、1の桁では点灯状態に、0の桁では消灯状態にすると良さそうです。さて、ここで点灯状態と消灯状態を表現するために行った操作に着目してみましょう。きっと、スイッチを用いて電源の電極と豆電球を接続したり切断するイメージをした方が多いのではないでしょうか。では、これをコンピュータはどのように行っているのでしょうか。まさか、初音ミクが手作業でスイッチを操作しているのでしょうか。だとするとこの地球上で最も過酷な重労働を課せられた存在ということになってしまいます。なぜなら、コンピュータが1秒間に扱う二進数は億という単位に及ぶからです。ということで実際には、トランジスタという半導体素子が電気信号を用いてスイッチ操作を行っているのです。CPUの進化を語るときにトランジスタの数や大きさが必ずと言っていいほど取り上げられるのはこれが理由です。  
ここまで、0と1をコンピュータが解釈する原理を説明してみました。もし、あなたがこの話題に強い興味を抱いたのであれば、この本で説明することの大半は朝飯前かもしれません。そんなあなたには、Swiftの魅力を伝える専門家として読み進めていただくことをお勧めします。逆に、もうお腹いっぱいだというあなた、ご安心ください。「0と1しか分からない」という単純に見えて超絶複雑なコンピュータとのコミュニケーション手段に革命をもたらしたのがプログラミング言語だったということを知っていただきたかったのです。とは言っても、プログラミングの難関に直面することもあるでしょう。そんな時は、冒頭でご紹介したコンピュータの動作原理を読み返してみてください。きっと、これに比べれば我々人間が理解しやすいものであることに気づけるはずです。ぜひ、広い視野でプログラミングの世界を楽しみましょう！

## Note
この書籍はSwift初心者が上達して一人前になるまでの間、何度も読み直すことを想定して執筆されています。そのため、1つの章の中だけでも文章を読むために必要となる技術レベルが大きく変化します。ですから、内容が難しいなと感じたら少し読み飛ばしてみてください。最終的にどのようなイメージを持てば良いかが直後に書かれています。  
また、本書はコーディングチュートリアルではないので、まずはSwift公式ドキュメント（docs.swift.org）やお好きな学習教材を使ってコーディングにチャレンジしてみてください。コツとしては、まずはプログラムを書いて動かしてみることでしょうか。どんなにシンプルなプログラムであっても、自分で作成したものが実際に目の前で動いたときの感動は格別です。こうしたコーディングを行っていく中で「動くのはわかったけど、なんで動くんだろう」という疑問が生まれてきたら本書をコーディングと並行して読み始めてみてください。  
そして、Swiftの真の魅力に気づいたあなたは、再度本書を読み返すタイミングが来ることでしょう。それは、職場の後輩や新しくSwiftを学び始めた方々にSwiftの魅力を伝える側になったときです。きっとあなたは、初めて本書を読んだときとまた別の学びを得ることができるはずです。

## Optional
“祝！マスターアップ！”

ソフトウェアのデバッグとそれに伴う不具合修正を終え、販売できる段階に到達したことをマスターアップと表現します。これを祝うイベントを広報活動の一つとして取り入れる文化もあり、特にゲーム業界に多いようです。  
なぜマスターアップを顧客に対して大々的に祝うのでしょうか。それは、発売前から発売を楽しみにしている顧客が大勢いるからです。多額の先行投資によって開発が進行している間も全力の広報活動が繰り広げられ、高められた顧客の期待とは裏腹に発売延期や仕様変更、価格改定といった悲報が届くことも少なくないでしょう。こうした苦難を共にした企業と顧客はもはや一心同体となっており、マスターアップという記念すべき日を迎えられたことを心から祝うのです。  
さて、明日発売予定だったゲームソフトが突然発売延期したらどうでしょう。この発売日に合わせて有給休暇を取得していたら？毎日全力で節約して購入費用を貯めてきたとしたら？きっと「えっ？」とフリーズすることでしょう。これと同じようなことがプログラム実行中にも発生するのです。それを防ぐ機能がSwiftには実装されており、その名をOptionalといいます。

enumで定義されたOptional型はsomeとnoneという2つのケースを持っています。これによって、値が存在する場合と存在しない場合を表現することを可能にしているのです。Optionalな整数を表現するには`Optional<Int>`と書くことができ、これを変数の型に指定した場合には、何らかの整数が代入される可能性とnilが代入される可能性があることを表現することができます。ですから、Optionalな変数を扱う際にはnilである可能性に配慮することを言語的に強制されるのです。このOptionalは一般的に疑問符を使って書かれることが多く、`Int?`となります。ちなみに、enumとはenumerationの略で、値を名前をつけたケースという単位でグループ化することを可能にするSwiftが持つ言語機能の一つです。  
さて、先程ご紹介した「突然のゲームソフト発売延期事件」を元に噛み砕いていきましょう。突然の発売延期に大きなショックを受けてしまったのは、ゲームの発売日が変わらないことを前提に有給休暇を取得していたことが原因だったのです。なので、発売日が変更される可能性を考慮して別のゲームソフトを準備しておくなどの対応策を準備しておくと良かったのかもしれません。つまり、発売予定日に発売される可能性と発売されない可能性を事前に考慮しておくことが重要で、これをSwiftではOptionalという型で表現できるのです。  
しかし、マスターアップの発表がされてしまえば発売日が変更される可能性を考慮する必要は無くなったに等しい状態となります。このように、時にはこのOptionalという状態から抜け出したくなるときがあります。ここで行う作業をアンラップと呼び、これはOptionalで値を表現する時に「その値をラップする」と表現することから来ています。実際には、Optionalなインスタンス変数からインスタンスプロパティであるunsafelyUnwrappedにアクセスすることでアンラップされた値を得ることができます。このアンラップは一般的に感嘆符を使って書かれることが多く、`Optional.some(174)!`のようになります。ただ、これは強制アンラップと呼ばれるもので、その値がnilだった場合にはアプリケーションがクラッシュしてしまいます。これを防ぐには、オプショナルバインディングもしくはnil合体演算子を活用したアンラップを行う必要があります。  
オプショナルバインディングとは、if文やguard文を用いてnilであるかの確認を行うと同時にアンラップまで行う方法です。対してnil合体演算子とは、nilだった場合のデフォルト値を指定する方法です。値の有無で実行処理が変化する場合は前者を、値がなかったとしてもデフォルト値を使って共通の処理を実行する場合は後者を利用するケースが多いです。

## Protocol
“Can I have this one, please?”

海外旅行で英語圏に行く場合、必ず使うであろうフレーズの一つです。海外旅行経験者から「これさえ覚えておけば良いフレーズ」として教わった方も多いかもしれません。英語に苦手意識があって、尚且つ実践的な英会話経験がない方にとっては「英語を話せなくてもなんとかなる」という経験者からのアドバイスは、にわかには信じがたいものだと思うことでしょう。もちろん、話せない度合いの解釈が人によって異なっている可能性を考慮する必要がありますが、英語が苦手でも海外旅行を満喫している方は少なくないように感じます。この要因の一つとして、生活環境における共通点の多さが挙げられるでしょう。  
例えば、レストランに行くと店員さんに席を案内してもらい、次の手順を踏むことが多いでしょう。

1. メニューを見る
2. お店のスタッフに注文内容を伝える
3. 食事をする
4. お会計をする

もちろん、チップ文化の有無による小さな違いはありますが、この基本手順が採用されている国や地域は多いでしょう。このような文化は様々な歴史的背景から一般化したとともに、現代の人々が期待しているレストランの基本として広く認知されているものです。ですから、必要最低限のコミュニケーションでもレストランでの食事を楽しむことができるのです。こうした手順について定めたものを一般的にプロトコルといい、新規でレストランを開業しようとする経営者もこのプロトコルに準拠しつつ、自社独自のオリジナリティをもたせるのです。このような表現をプログラム上で実現させる機能がSwiftには実装されており、その名をProtocolといいます。
Protocolはclassやstruct、enumなどに対して特定のプロパティやメソッド、イニシャライザの実装を約束させるための言語機能です。まず、プロパティといってもその種類は複数存在し、インスタンスが値を保持するStored Properties、値を保持せずに都度返却内容を計算して返すComputed Properties、インスタンスから独立して値を保持するType Propertiesが代表的なものとして挙げられます。Stored Propertiesでの実装を想定する場合はアクセス権限として読み取り専用なのか読み書き可能なのかをProtocolで指定することになります。逆にComputed Propertiesでの実装を想定する場合は、値を保持しないため読み取り専用として指定することになります。これらに加えてType Propertiesとして実装することを想定する場合には、静的プロパティであることを示すstatic修飾子を付与します。  
次に、メソッドはfuncキーワードから始まり、メソッド名、引数名、引数の型から成る処理群です。Protocolではメソッドの定義のみで、実装を含まないことに注意してください。ただし、Protocolでのメソッド定義では外部引数名と内部引数名の区別を指定することができないという制限もあります。つまり、外部引数名のみを指定することになります。  
最後にクラスと構造体、そしてイニシャライザに関してみていきましょう。クラスは参照型で構造体は値型であるという大きな違いがあり、この違いはC言語に代表されるポインタを扱う言語で特に意識することの多い概念です。しかし、Swiftにおいても非常に重要な知識なので、後ほどご紹介いたします。そしてイニシャライザとは、クラスや構造体を初期化するために利用されるメソッドの一種で、インスタンス化に必要な初期値の設定などを行います。例えば、iOSにおけるUIViewControllerもクラスとして定義されているため、イニシャライザが利用可能です。

ここまで、Protocolが実装のルールを定義することができる言語機能であり、プロパティやメソッド、イニシャライザの定義を細かく指定できることをご紹介しました。では、これには一体どんな利点があるのでしょうか。それは、クラスや構造体を抽象化できることにあります。抽象化により、クラスや構造体間の強い依存を弱めることが可能になり、コードの可読性を高めることができます。この特性の活用術は様々で、例えば単体テストを書きやすい実装法の一つとしても知られています。  
さて、先程ご紹介した「海外のレストラン」を元に噛み砕いていきましょう。メニューから食べたいものを選んで、会計をするという手順は国や言語が違ったとしても同じで、これが抽象化された状態に当たります。逆に、もう少し詳しく見ていくと、海外にはチップを支払う文化があり、一度支払いを済ませたあとに金額を訂正する形でチップを支払うことがあります。更に、日本国内でも券売機で先に支払いを済ませるスタイルや、席でタブレット端末を操作して注文や決済を済ませるスタイルなど、レストランの数だけ利用スタイルが存在しています。これがプログラムでの実装に当たる部分で、具体化されたものと言えます。このように、抽象化された情報は、初めて海外に行く友人にアドバイスするときにも伝えやすいですし、その友人が実際に海外のどのレストランで食事をしたとしても共通して役立つ情報となることでしょう。これこそ、抽象化と依存分離の利点と言えるでしょう。

Appleは年に一度WWDCという技術者向けのイベントを開催しています。その中ではSwiftに関する最新情報の発表も行われ、直近ではオンラインで全世界同時配信されています。更に、Apple本社のあるカリフォルニアにてオフライン形式でWWDCに参加することも可能です。このオフラインイベントは例年抽選が実施されており、限られた人のみが招待される非常に貴重な機会であることで知られています。今これを読んでくださっている皆さんにはぜひ、このオフラインイベントへの参加にチャレンジしていただきたいです。英語が苦手という方もご安心ください、全世界共通のプロトコルは必ずありますから。

## Delegation Pattern
“ただの人間には興味ありません。この中に宇宙人、未来人、異世界人、超能力者がいたら、あたしのところに来なさい。”

これは涼宮ハルヒシリーズに登場するメインヒロイン、涼宮ハルヒが実際に作中で口にした自己紹介の一部です。そんな彼女が団長を務めるSOS団には普通の人間とはかけ離れた独特なメンバーが入団しています、1人の例外を除いて。そんな団員メンバーは、涼宮ハルヒの特殊能力暴走を防ぐため、彼女の様々な要求に応じていくことになります。涼宮ハルヒシリーズは、ライトノベルを原作としてアニメ化や映画化も果たしている作品ですので、プログラミングで苦戦したときの息抜きとして観てみてはいかがでしょうか。長門有希の神がかったタイピングに負けまいとやる気が漲ってくることでしょう。
さて、涼宮ハルヒが対等に会話できる相手が限られるように、プログラム上でも特定の条件に合致しない限り実行できない処理というものが存在します。それがデリゲーション、つまり処理の委譲であり、その手法をデリゲーションパターンと呼びます。これは、Swiftの言語機能そのものを示すものではなく、デザインパターンと呼ばれる設計手法を示す用語です。デザインとは設計のことで、パターンとは言語化された雛形を示し、言語化された再利用可能な設計手法に名前が付いたものです。

デリゲーションパターンを一般的な事柄で例えると、仕事やイベントのプランニングに参加することに似ています。

例えば、ある大規模なイベントが開催されることになり、多くのタスクがあります。主催者は一人で全てのタスクを管理することは難しいため、彼らはそれぞれのタスクを担当する人々を選びます。それぞれの担当者は、自分が責任を持つ特定のタスクについて責任を持ちますが、全体の責任は主催者が持ちます。

この場合、主催者がデリゲートであり、担当者がデリゲートとして機能します。主催者は全体の管理や調整を担当し、特定のタスクを担当する人々に責任を委譲します。担当者は自分の責任範囲内でタスクを実行し、必要に応じて主催者に報告します。主催者はその報告を受けて全体の状況を把握し、必要に応じて調整や判断を行います。

同様に、Swiftのデリゲーションパターンでは、あるクラスやオブジェクト（デリゲート）が他のクラスやオブジェクトに一部の責任を委譲し、特定のイベントやタスクの処理を行います。委譲されたクラスやオブジェクトは、そのイベントやタスクの実行を担当し、必要に応じてデリゲートに通知します。デリゲートは通知を受け取り、適切な処理を行います。

## Asynchronous
非同期処理を一般的な事柄で例えると、レストランでの食事の注文と待ち時間に似ています。

あるレストランに行ったとき、メニューから食事を注文します。注文が受け付けられると、料理が調理されるまで待つ必要があります。この待ち時間中、あなたは他のことをすることができます。例えば、友達と会話をしたり、スマートフォンでニュースを読んだりすることができます。

同様に、非同期処理では、プログラムが処理を行っている最中に他の処理を実行することができます。例えば、ネットワークリクエストを送信してデータを取得する際、通常はサーバーからのレスポンスを待つ必要があります。しかし、非同期処理を使用すると、リクエストを送信した後にプログラムの他の部分を実行しながら、レスポンスを待つことができます。これにより、プログラム全体の効率が向上し、ユーザーの待ち時間が最小限に抑えられます。

## visionOS
...

## Conclusion
...
